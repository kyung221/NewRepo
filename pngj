package example;

import android.content.res.AssetManager;
import android.media.Image;

import org.junit.Assert;
import org.junit.Before;
import org.junit.Test;

import java.io.ByteArrayOutputStream;
import java.io.InputStream;
import java.util.Arrays;
import java.util.Random;

import ar.com.hjg.pngj.ImageLineByte;
import ar.com.hjg.pngj.ImageLineInt;
import ar.com.hjg.pngj.PngReader;
import ar.com.hjg.pngj.PngReaderByte;

import static junit.framework.Assert.assertEquals;
import static junit.framework.Assert.assertNotNull;

/**
 * Created by alchera on 18. 1. 11.
 */

class FrameData2
{
    //    int format; // Always ARGB32
    int width, height;
    int channel;
    int [] data;
}

public class Test2 extends TestBackbone {

    FrameData2 lhs,rhs;
    PngReader pngl, pngr;
    AssetManager am;

    @Before
    public void LoadImage1() throws Exception{
        String filename = "cat.png";
        lhs=new FrameData2();

        am=context.getAssets();
        pngl = new PngReader(am.open(filename));
        lhs.channel = pngl.imgInfo.channels;

        lhs.width=pngl.imgInfo.cols;
        lhs.height=pngl.imgInfo.rows;
        lhs.data = new int[lhs.width*lhs.width*lhs.channel];

        Assert.assertNotNull(lhs);
        Assert.assertNotNull(lhs.data);
        ImageLineInt line;
        int[] line1;
        for(int i=0;i<lhs.height;i++) {
            line = (ImageLineInt)pngl.readRow(i);
            line1 = line.getScanline();
            lhs.data[(line1.length)*i]=line1[0];
            System.arraycopy(line1,0,lhs.data,(line1.length)*i,line1.length);

        }

        assertNotNull(lhs);
    }

    @Before
    public void LoadImage2() throws Exception{
        String filename = "cat_flip.png";
        rhs=new FrameData2();
        am=context.getAssets();
        pngr = new PngReader(am.open(filename));
        rhs.channel = pngr.imgInfo.channels;

        rhs.width=pngr.imgInfo.cols;
        rhs.height=pngr.imgInfo.rows;
        rhs.data = new int[rhs.width*rhs.width*rhs.channel];

        Assert.assertNotNull(rhs);
        Assert.assertNotNull(rhs.data);
        ImageLineInt line;
        int[] line1;
        for(int i=0;i<rhs.height;i++) {
            line = (ImageLineInt)pngr.readRow(i);
            line1 = line.getScanline();
            rhs.data[(line1.length)*i]=line1[0];
        }
        assertEquals(514,rhs.data.length);

        assertNotNull(rhs);
    }

    @Test
    public void CheckSize(){
        assertEquals(lhs.width, rhs.width);
        assertEquals(lhs.height, rhs.height);
    }

    @Test
    public void EnsureChan4(){
        assertEquals(4, rhs.channel);
        assertEquals(4, lhs.channel);
    }

    @Test
    public void CheckData(){
        Random rng = new Random();

        int length = lhs.width * rhs.height * lhs.channel;
        int count = 16;
        while(count-- > 0){
            int idx = rng.nextInt(length - 1);
            int ridx = length - idx - 1;
            Assert.assertEquals(lhs.data[idx], rhs.data[ridx]);
        }

    }

//    @Test
//    public void CheckData2(){
//        Random rng = new Random();
//
//        int length = lhs.width * rhs.height * lhs.channel;
//        int count = 16;
//
//        while(count-- > 0){
//            int idx = rng.nextInt(length - 1);
//            int ridx = 521*((idx/512)+1)-idx%2;
//
//            Assert.assertEquals(lhs.data[idx], rhs.data[ridx]);
//        }
//    }
}
